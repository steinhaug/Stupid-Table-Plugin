!function(t){t.fn.stupidtable=function(n){return this.each(function(){var a=t(this);n=n||{},n=t.extend({},t.fn.stupidtable.default_sort_fns,n),a.data("sortFns",n),a.stupidtable_build(),a.on("click.stupidtable","thead th",function(){t(this).stupidsort()}),a.find("th[data-sort-onload=yes]").eq(0).stupidsort()})},t.fn.stupidtable.default_settings={should_redraw:function(t){return!0},will_manually_build_table:!1},t.fn.stupidtable.dir={ASC:"asc",DESC:"desc"},t.fn.stupidtable.default_sort_fns={int:function(t,n){return parseInt(t,10)-parseInt(n,10)},float:function(t,n){return parseFloat(t)-parseFloat(n)},string:function(t,n){return t.toString().localeCompare(n.toString())},"string-ins":function(t,n){return t=t.toString().toLocaleLowerCase(),n=n.toString().toLocaleLowerCase(),t.localeCompare(n)}},t.fn.stupidtable_settings=function(n){return this.each(function(){var a=t(this),r=t.extend({},t.fn.stupidtable.default_settings,n);a.stupidtable.settings=r})},t.fn.stupidsort=function(d){var o=t(this),u=o.data("sort")||null;if(null!==u){var l=o.closest("table"),c={$th:o,$table:l,datatype:u};if(l.stupidtable.settings||(l.stupidtable.settings=t.extend({},t.fn.stupidtable.default_settings)),c.compare_fn=l.data("sortFns")[u],c.th_index=s(c),c.sort_dir=i(d,c),o.data("sort-column")){var f=a(l,o.data("sort-column"));c.th_index=f.index}return o.data("sort-dir",c.sort_dir),l.trigger("beforetablesort",{realColumn:s(c),column:c.th_index,direction:c.sort_dir,$th:o}),l.css("display"),setTimeout(function(){l.stupidtable.settings.will_manually_build_table||l.stupidtable_build();var t=n(c),a=r(t,c);l.stupidtable.settings.should_redraw(c)&&(l.children("tbody").append(a),e(c),l.trigger("aftertablesort",{column:c.th_index,direction:c.sort_dir,$th:o}),l.css("display"))},10),o}},t.fn.updateSortVal=function(n){var a=t(this);return a.is("[data-sort-value]")&&a.attr("data-sort-value",n),a.data("sort-value",n),a},t.fn.stupidtable_build=function(){return this.each(function(){var n=t(this),a=[];n.children("tbody").children("tr").each(function(n,r){var e={$tr:t(r),columns:[],index:n};t(r).children("td").each(function(n,a){var r=t(a).data("sort-value");if(void 0===r){var i=t(a).text();t(a).data("sort-value",i),r=i}e.columns.push(r)}),a.push(e)}),n.data("stupidsort_internaltable",a)})};var n=function(n){var r,e=n.$table.data("stupidsort_internaltable"),i=n.th_index,s=n.$th.data("sort-multicolumn");r=s?s.split(","):[];var d=t.map(r,function(t,r){return a(n.$table,t)});return e.sort(function(t,a){for(var r=d.slice(0),e=n.compare_fn(t.columns[i],a.columns[i]);0===e&&r.length;){var s=r[0],o=s.$e.data("sort");e=(0,n.$table.data("sortFns")[o])(t.columns[s.index],a.columns[s.index]),r.shift()}return 0===e?t.index-a.index:e}),n.sort_dir!=t.fn.stupidtable.dir.ASC&&e.reverse(),e},a=function(t,n){var a,r=t.find("th"),e=parseInt(n,10);return e||0===e?a=r.eq(e):(a=r.siblings("#"+n),e=r.index(a)),{index:e,$e:a}},r=function(n,a){var r=t.map(n,function(t,n){return[[t.columns[a.th_index],t.$tr,n]]});return a.column=r,t.map(n,function(t){return t.$tr})},e=function(t){var n=t.$table,a=t.$th,r=a.data("sort-dir");n.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc"),a.data("sort-dir",r).addClass("sorting-"+r)},i=function(n,a){var r,e=a.$th,i=t.fn.stupidtable.dir;return n?r=n:(r=n||e.data("sort-default")||i.ASC,e.data("sort-dir")&&(r=e.data("sort-dir")===i.ASC?i.DESC:i.ASC)),r},s=function(n){var a=0,r=n.$th.index();return n.$th.parents("tr").find("th").slice(0,r).each(function(){var n=t(this).attr("colspan")||1;a+=parseInt(n,10)}),a}}(window.jQuery);
